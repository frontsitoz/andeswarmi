<div
  *ngIf="product as prod"
  class="fixed inset-0 z-[1000] bg-black/40 flex justify-end items-stretch"
  (click)="onOverlayClick()"
>
  <aside
    role="dialog"
    aria-modal="true"
    aria-labelledby="product-title"
    (click)="$event.stopPropagation()"
    class="w-[520px] h-screen bg-white shadow-[-4px_0_12px_rgba(0,0,0,0.10)] flex flex-col relative overflow-y-auto rounded-[12px_0_0_12px] px-9 pt-10 pb-7 modal-slide-in"
  >
    <!-- Cerrar -->
    <button
      (click)="closeModal()"
      aria-label="Cerrar"
      class="absolute top-5 right-5 text-[#523b2b] text-[26px] transition-transform hover:scale-110"
    >
      ✕
    </button>

    <!-- BODY -->
    <div class="flex flex-col">
      <!-- Imagen -->
      <div class="w-full h-[520px] flex items-center justify-center bg-white rounded-xl mb-6">
        <!-- Carrusel -->
        <ngb-carousel
          *ngIf="images.length > 1"
          [showNavigationArrows]="true"
          [showNavigationIndicators]="true"
          class="w-full"
        >
          <ng-template ngbSlide *ngFor="let img of images; let i = index">
            <img
              [src]="img"
              class="max-w-[90%] max-h-[520px] object-contain rounded-xl mx-auto block"
              alt="{{ prod.name }} - {{ i + 1 }}"
              (load)="onImageLoad(i)"
            />
            <div *ngIf="!imagesLoaded[i]" class="text-center text-[14px] text-[#7a7a7a] mt-3">
              Loading image...
            </div>
          </ng-template>
        </ngb-carousel>

        <!-- Imagen única -->
        <ng-container *ngIf="images.length === 1">
          <img
            [src]="images[0]"
            class="max-w-[90%] max-h-[520px] object-contain rounded-xl mx-auto block"
            alt="{{ prod.name }}"
            (load)="onImageLoad(0)"
          />
          <div *ngIf="!imagesLoaded[0]" class="text-center text-[14px] text-[#7a7a7a] mt-3">
            Loading image...
          </div>
        </ng-container>

        <!-- Fallback: imagen principal -->
        <ng-container *ngIf="images.length === 0 && prod.image">
          <img
            [src]="prod.image"
            class="max-w-[90%] max-h-[520px] object-contain rounded-xl mx-auto block"
            alt="{{ prod.name }}"
            (load)="onImageLoad(0)"
          />
          <div *ngIf="!imagesLoaded[0]" class="text-center text-[14px] text-[#7a7a7a] mt-3">
            Loading image...
          </div>
        </ng-container>

        <!-- Sin imagen -->
        <ng-container *ngIf="images.length === 0 && !prod.image">
          <div class="text-[#7a7a7a]">No image available</div>
        </ng-container>
      </div>

      <!-- INFO -->
      <div class="px-2 text-left">
        <p class="font-bold text-[#523b2b] text-[20px] mb-3">$ {{ prod.price }}</p>

        <h5 id="product-title" class="text-[#523b2b] font-semibold text-[22px] mb-4">
          {{ prod.name }}
        </h5>

        <p class="text-[#555] text-[15px] leading-[1.6] mb-6 max-w-[95%]">
          {{ prod.description }}
        </p>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="mt-auto pt-4 border-t border-[#eee]">
      <button
        aria-label="Add to cart"
        (click)="addToCart(prod)"
        class="w-full h-[54px] rounded-[12px] bg-[#523b2b] text-white font-semibold text-[16px] flex items-center justify-center gap-3 transition-colors duration-200 hover:bg-[#3e2e21]"
      >
        <img
          [src]="isAdded ? 'assets/icons/bt_added_to_cart.svg' : 'assets/icons/bt_add_to_cart.svg'"
          alt="cart"
          class="w-10 h-10"
        />
        Add to cart
      </button>
    </div>
  </aside>
</div>
